<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="pt">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Cálculo dos Activos em TARV • sonata</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cálculo dos Activos em TARV">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sonata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Referência</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-artigos" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Artigos</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-artigos">
<li><a class="dropdown-item" href="../articles/definir-credenciais.html">Uso de Credenciais MozART 2.0</a></li>
    <li><a class="dropdown-item" href="../articles/chamar-activos-e-recodificar.html">Cálculo dos Activos em TARV</a></li>
    <li><a class="dropdown-item" href="../articles/analisar-transicao-etaria.html">Detectar Transição Etária</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-outro" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Outro</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-outro">
<li><a class="external-link dropdown-item" href="https://helpdeskmoz.sis.org.mz/portal/pt/kb/mozart/manuais-materiais-de-forma%C3%A7%C3%A3o-e-pop/dicion%C3%A1rio-de-dados">Dicionário de Dados (MozART 2.0)</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/usaid-mozambique/sonata"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Cálculo dos Activos em TARV</h1>
            
      

      <div class="d-none name"><code>chamar-activos-e-recodificar.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="anexar-pacotes">Anexar pacotes<a class="anchor" aria-label="anchor" href="#anexar-pacotes"></a>
</h2>
<p>Primeiro, anexaremos os pacotes requiridos para extrair e manipular
dos dados de MozART 2.0.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usaid-mozambique.github.io/sonata/">sonata</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">glamr</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Se preciso, instale o `glamr` com código abaixo</span></span>
<span><span class="co"># install.packages('glamr', repos = c('https://usaid-oha-si.r-universe.dev', 'https://cloud.r-project.org'))</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estabelecer-conexão">Estabelecer conexão<a class="anchor" aria-label="anchor" href="#estabelecer-conex%C3%A3o"></a>
</h2>
<p>Como descrito no artigo <a href="https://usaid-mozambique.github.io/sonata/articles/definir-credenciais.html">Uso
de Credenciais MozART 2.0</a> é recomendado carregar no ambiente R as
suas credenciais a partir do sistema operativo. Isto evita elas estarem
no script e a partilha não intencional. O código abaixo mostra como
carregar credenciais seguramente e estabelecer uma conexão com a base de
dados.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Definir valor do usuário</span></span>
<span><span class="va">acct_dev</span> <span class="op">&lt;-</span> <span class="st">"mysql-example-user"</span></span>
<span></span>
<span><span class="co"># Carregar credenciais</span></span>
<span><span class="va">acct_db</span> <span class="op">&lt;-</span> <span class="fu">get_account</span><span class="op">(</span>name <span class="op">=</span> <span class="va">acct_dev</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Criar uma ligação MozART 2.0</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mysql_connection.html">mysql_connection</a></span><span class="op">(</span>db_name <span class="op">=</span> <span class="va">acct_db</span><span class="op">$</span><span class="va">dbname</span>, </span>
<span>                        db_user <span class="op">=</span> <span class="va">acct_db</span><span class="op">$</span><span class="va">username</span>,</span>
<span>                        db_pass <span class="op">=</span> <span class="va">acct_db</span><span class="op">$</span><span class="va">password</span>,</span>
<span>                        db_host <span class="op">=</span> <span class="va">acct_db</span><span class="op">$</span><span class="va">host</span>,</span>
<span>                        db_port <span class="op">=</span> <span class="va">acct_db</span><span class="op">$</span><span class="va">port</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="chamar-activos-em-tarv">Chamar “Activos em TARV”<a class="anchor" aria-label="anchor" href="#chamar-activos-em-tarv"></a>
</h2>
<p>MozART 2.0 é composta por tabelas de dados ligadas entre si por
chaves variáveis. Esta organização de dados, embora óptima para a
eficiência do armazenamento, torna mais complexa a tarefa de criar
tabelas analíticas. <code>sonata</code> foi concebido para fornecer
funções fáceis de utilizar que reduzem a necessidade de escrever código
complexo em R ou SQL. <code>calc_tx_active</code>, que extrai uma lista
de clientes activos em TARV, é um exemplo deste tipo de função oferecido
no <code>sonata</code>. Um caso de uso típico é demonstrado como parte
deste artigo.</p>
<p><code>calc_tx_active</code> traz 5 argumentos. 2 argumentos vêm sem
valores predefinidos e requerem definição pelo utilizador. 3 argumentos
têm valores pré-defindo que são modificáveis de acordo com as
necessidades da analista. O primeiro argumento, “con”, é a ligação ao
MozART 2.0 aberto no ambiente R (no exemplo abaixo também definido como
“con”). O segundo argumento obrigatório, “enddate”, exige o fecho do
período de avaliação, que será utilizado como referência para determinar
o estado dos clientes avaliados. O terceiro argumento,
“defaulter_tolerance”, posibilita a custumização do número de dias antes
de um faltoso ser reclassificado como inactivo (ou “abandono”).</p>
<p>O quarto e o quinto argumentos (“filter_by_location” e
“location_uuid”) são argumentos que permitem que o query seja executado
sobre uma unidade sanitária individual em vez de todas as mais de 600
unidades sanitárias contidas no MozART 2.0. Isso traz uma forma mais
ágil de testar código numa conexão activa. Quando filter_by_location é
definido como “TRUE”, o query será adequado para ser executada numa
única base de dados definida pelo utilizador no argumento
“location_uuid”.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Definir location_uuid para a CS Merripo</span></span>
<span><span class="va">location_meripo</span> <span class="op">&lt;-</span> <span class="st">"e5f01eee-2392-49b4-a5bf-5cf593fc8f21"</span></span>
<span></span>
<span><span class="co"># Chamar `calc_tx_active`</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_tx_active.html">calc_tx_active</a></span><span class="op">(</span></span>
<span>  con <span class="op">=</span> <span class="va">con</span>,</span>
<span>  enddate <span class="op">=</span> <span class="st">'2024-09-20'</span>,</span>
<span>  defaulter_tolerance <span class="op">=</span> <span class="fl">28</span>, <span class="co"># valor por defeito</span></span>
<span>  filter_by_location <span class="op">=</span> <span class="cn">TRUE</span>,  <span class="co"># valor por defeito</span></span>
<span>  location_uuid <span class="op">=</span> <span class="va">location_meripo</span>  <span class="co"># valor por defeito</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="recodificar-variáveis">Recodificar variáveis<a class="anchor" aria-label="anchor" href="#recodificar-vari%C3%A1veis"></a>
</h2>
<p>Inspecionando os variáveis contidos no objecto criado pela
<code>calc_tx_activo</code> repara-se que varias colunas são codificados
numericamente e não fornecem informação suficiente para interpretar.
<code>recode_cols</code> oferece uma forma simples de recodificar esses
valores usando as tabelas de referência armazenadas internamente no
<code>sonata</code>. No exemplo abaixo, chamamos
<code>recode_cols</code> e definimos o argumento <code>cols</code> para
descodificar os valores apresentados em 5 colunas -
“mode_dispensation_id”, “regimen_id”, “location_uuid”, “age”, “form_id”
e “gender”. O argumento <code>cols</code> pode ser adaptado de acordo
com as colunas presentes no objeto de dados.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_recode</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/recode_cols.html">recode_cols</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mode_dispensation_id"</span>, </span>
<span>                       <span class="st">"regimen_id"</span>, </span>
<span>                       <span class="st">"location_uuid"</span>, </span>
<span>                       <span class="st">"age"</span>,</span>
<span>                       <span class="st">"form_id"</span>,</span>
<span>                       <span class="st">"gender"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Utilizando apenas algumas funções da <code>sonata</code>, criámos um
conjunto de dados que pode ser utilizado para responder à nossa questão
analítica, seja ela qual for. Finalmente, lembre-se de nunca gravar
conjuntos de dados de nível individual no seu disco local! Em vez disso,
agrupe os valores por todas as caraterísticas de dados relevantes e
guarde-os como um conjunto de dados agregado. Boa análise!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joe Lara, Karishma Srikanth, Baboyma Kagniniwa, Timothy Essam.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
